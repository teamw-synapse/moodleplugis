/**
 * Add a create new group modal to the page.
 *
 * @module     local_note/register
 * @class      register
 * @package    local_note
 * @copyright  2023 Bhupathi
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define(["jquery","local_rolemanagement/cardPaginate","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/notification","core/templates"],function(t,o,e,n,a,r,s,c,l,d){var u=function(t,o,e){this.contextid=o,this.id=e,this.init(t)};return u.prototype.modal=null,u.prototype.contextid=-1,u.prototype.init=function(o){var r=this;return e.get_string("note","local_note").then((function(t){return n.create({type:n.types.DEFAULT,title:t,body:r.getBody(),footer:this.getFooter()})}).bind(r)).then((function(o){return r.modal=o,r.modal.getRoot().addClass("customclass local_note"),r.modal.setLarge(),this.modal.getRoot().on(a.hidden,(function(){o.destroy()}).bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){window.location.href=window.location.href}),this.modal.getFooter().find('[data-action="skip"]').on("click",function(){r.args.form_status=r.args.form_status+1;var t=r.getBody();o.setBody(t)}),this.modal.getRoot().on("submit","form",function(t){r.submitFormAjax(t,r.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),t(".close").click(function(){window.location.href=window.location.href}),this.modal}).bind(this))},u.prototype.getBody=function(t){return void 0===t&&(t={}),(params={}).jsonformdata=JSON.stringify(t),params.id=this.id,r.loadFragment("local_note","note_form",this.contextid,params)},u.prototype.getFooter=function(){return console.log(this),$footer=this.id?'<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':'<button type="button" class="btn btn-primary" data-action="save">Save</button>&nbsp;',0==this.form_status&&($footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+($style='style="display:none;"')+">Skip</button>&nbsp;"),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>'},u.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),c.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),document.location.reload()},u.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},u.prototype.submitFormAjax=function(t){t.preventDefault();var o=this.modal.getRoot().find("form").serialize();console.log(JSON.stringify(o)),s.call([{methodname:"local_note_save",args:{contextid:this.contextid,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}])},u.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(o){console.log(o),s.call([{methodname:"block_facultydashboard",args:{userid:o}}])[0].done(function(o){console.log(o.totalcourses);var e=o.totalcourses,n=o.userid;d.renderForPromise("block_facultydashboard/dashboard",o,e,n).then(({html:o,js:e})=>{t("#facultydashboardid").html(o)}).catch(t=>displayException(t))}).fail(function(t){}),console.log("fail")},load:function(e){t(document).ready(function(){t(document).on("change","#id_facultyids",function(){var e=t("#id_facultyids :selected").val();if(e>0){var n={};n.targetID="dashboard",n.perPage=4,n.cardClass="w_one",n.viewType="card",n.methodName="block_facultydashboard",n.templateName="block_facultydashboard/view-cards";var a={};a.userid=e,a.contextid=1;var r={},s={};s.targetID="dashboard",s.options=JSON.stringify(n),s.dataoptions=JSON.stringify(a),s.filterdata=JSON.stringify(r),o.reload(n,a,r)}}),t("#fitem_id_facultyids").on("keyup",function(){var o=t("#fitem_id_facultyids").find(".form-control").first().val();o.length>3&&s.call([{methodname:"report_searchfaculty",args:{search:o}}])[0].done(function(o){for(i=0,facultyselOpts=" <option value='0'>Select Faculty Name</option>",selopt="";i<o.users.length;i++){var e=o.users[i].facultyid,n=o.users[i].facultyname;selopt+='<li role="option" data-value="'+e+'" aria-selected="false" >'+n+"</li>",facultyselOpts+="<option value='"+e+"'>"+n+"</option>"}t("#id_facultyids").children().remove().end().append(facultyselOpts),t("#fitem_id_facultyids .form-autocomplete-suggestions").children().remove().end().append(selopt),t("#fitem_id_facultyids .form-autocomplete-suggestions").css("display","block")}).fail(function(t){})})})},deleteConfirm:function(t){return console.log(t),e.get_strings([{key:"confirm"},{key:"deleteconfirm",component:"local_note",param:t},{key:"deleteallconfirm",component:"local_note"},{key:"delete"}]).then((function(o){n.create({title:o[0],type:n.types.SAVE_CANCEL,body:o[1]}).done((function(e){this.modal=e,e.setSaveButtonText(o[3]),e.getRoot().on(a.yes,(function(o){o.preventDefault(),t.confirm=!0,console.log(t);var e={};e.id=t.id,e.contextid=t.contextid,s.call([{methodname:"local_note_delete_employee",args:e}])[0].done(function(t){window.location.href=window.location.href}).fail(function(t){console.log(t)})}).bind(this)),e.show()}).bind(this))}).bind(this))}}});