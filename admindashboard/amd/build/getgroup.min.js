/**
 * Add a create new group modal to the page.
 *
 * @module     local_studentdashboard/register
 * @class      register
 * @package    local_studentdashboard
 * @copyright  2017 Shivani
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/templates","core/ajax","core/yui"],function(t,o,e,n,r,a,d,s){var c=function(t){this.contextid=t.contextid,this.courseid=t.courseid,this.init(t)};return c.prototype.modal=null,c.prototype.contextid=-1,c.prototype.init=function(r){var a=this;return o.get_string("creategroup","block_admindashboard").then((function(t){return e.create({type:e.types.SAVE_CANCEL,title:t,body:a.getBody()})}).bind(a)).then((function(o){return a.modal=o,a.modal.setLarge(),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),t(".close").click(function(){o.destroy()}),this.modal.getRoot().on(n.save,this.submitForm.bind(this)),this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal}).bind(this))},c.prototype.getBody=function(t){void 0===t&&(t={});var o={jsonformdata:JSON.stringify(t),courseid:this.courseid};return r.loadFragment("block_admindashboard","create_groups",this.contextid,o)},c.prototype.getFooter=function(){return'<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>'},c.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),s.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var o=t("#id_enrollcourse").val();d.call([{methodname:"report_category",args:{id:0,subid:0,unitid:o||0}}])[0].done(function(o){for(i=0,subselOpts=" <option value='0'>Select Group Name</option>";i<o.groups.length;i++){var e;subselOpts+="<option value='"+o.groups[i].groupid+"'>"+o.groups[i].groupname+"</option>"}t("#id_enrollgroup").children().remove().end().append(subselOpts)}).fail(function(t){})},c.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},c.prototype.submitFormAjax=function(o){o.preventDefault();var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),this.modal.getRoot().find(":input").each(function(t,o){o.dispatchEvent(e)});var n=t.merge(this.modal.getRoot().find('[aria-invalid="true"]'),this.modal.getRoot().find(".error"));if(n.length){n.first().focus();return}var r=this.modal.getRoot().find("form").serialize();d.call([{methodname:"block_admindashboard_submit_create_group_form",args:{contextid:this.contextid,jsonformdata:JSON.stringify(r)},done:this.handleFormSubmissionResponse.bind(this,r),fail:this.handleFormSubmissionFailure.bind(this,r)}])},c.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(){var o=t("#id_enrollcourse").val();(args={}).courseid=o;var e=0;t.ajax({url:M.cfg.wwwroot+"/blocks/admindashboard/contextajax.php",data:{courseid:o},type:"POST",success:function(t){console.log(t);var o=JSON.parse(t);return console.log(o),e=o.contextid,console.log(e),args.contextid=e,console.log(args),new c(args)}})},load:function(){},deleteConfirm:function(t){return o.get_strings([{key:"confirm"},{key:"deleteconfirm",component:"local_studentdashboard",param:t},{key:"deleteallconfirm",component:"local_studentdashboard"},{key:"delete"}]).then((function(o){e.create({title:o[0],type:e.types.SAVE_CANCEL,body:o[1]}).done((function(e){this.modal=e,e.setSaveButtonText(o[3]),e.getRoot().on(n.yes,(function(o){o.preventDefault(),t.confirm=!0,console.log(t);var e={};e.id=t.id,e.contextid=t.contextid,d.call([{methodname:"local_studentdashboard_delete_employee",args:e}])[0].done(function(t){window.location.href=window.location.href}).fail(function(t){console.log(t)})}).bind(this)),e.show()}).bind(this))}).bind(this))}}});